---
- name: Install postgresql
  yum: name=postgresql-server.x86_64 state=installed

- name: initdb postgresql
  command: service postgresql initdb creates=/var/lib/pgsql/data/pg_hba.conf

- name: Add galaxy authentication in pg_hba.conf
  blockinfile:
    dest: /var/lib/pgsql/data/pg_hba.conf
    insertafter: "# TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD"
    content: |
      local   galaxy-pasteur         galaxy-pasteur                                trust
      host    galaxy-pasteur         galaxy-pasteur          124.0.0.1/32          trust
      host    galaxy-pasteur         galaxy-pasteur          ::1/128               trust
  notify:
    - restart postgresql

- name: Ensure postgresql is running and enabled
  service: name=postgresql state=running enabled=yes